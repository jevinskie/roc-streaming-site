<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Roc Toolkit internal modules: roc::audio::LatencyTuner Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- <script src="/analytics.js"></script> -->
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon80.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Roc Toolkit internal modules
   </div>
   <div id="projectbrief">Roc Toolkit: real-time audio streaming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classroc_1_1audio_1_1LatencyTuner.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classroc_1_1audio_1_1LatencyTuner-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">roc::audio::LatencyTuner Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Latency tuner.  
 <a href="classroc_1_1audio_1_1LatencyTuner.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="latency__tuner_8h_source.html">latency_tuner.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for roc::audio::LatencyTuner:</div>
<div class="dyncontent">
<div class="center"><img src="classroc_1_1audio_1_1LatencyTuner__inherit__graph.png" border="0" usemap="#aroc_1_1audio_1_1LatencyTuner_inherit__map" alt="Inheritance graph"/></div>
<map name="aroc_1_1audio_1_1LatencyTuner_inherit__map" id="aroc_1_1audio_1_1LatencyTuner_inherit__map">
<area shape="rect" title="Latency tuner." alt="" coords="21,80,201,107"/>
<area shape="rect" href="classroc_1_1core_1_1NonCopyable.html" title="Base class for non&#45;copyable objects." alt="" coords="5,5,216,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for roc::audio::LatencyTuner:</div>
<div class="dyncontent">
<div class="center"><img src="classroc_1_1audio_1_1LatencyTuner__coll__graph.png" border="0" usemap="#aroc_1_1audio_1_1LatencyTuner_coll__map" alt="Collaboration graph"/></div>
<map name="aroc_1_1audio_1_1LatencyTuner_coll__map" id="aroc_1_1audio_1_1LatencyTuner_coll__map">
<area shape="rect" title="Latency tuner." alt="" coords="21,80,201,107"/>
<area shape="rect" href="classroc_1_1core_1_1NonCopyable.html" title="Base class for non&#45;copyable objects." alt="" coords="5,5,216,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af1ec4c62334dacda1699aad9401f4c3c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#af1ec4c62334dacda1699aad9401f4c3c">LatencyTuner</a> (const <a class="el" href="structroc_1_1audio_1_1LatencyConfig.html">LatencyConfig</a> &amp;config, const <a class="el" href="classroc_1_1audio_1_1SampleSpec.html">SampleSpec</a> &amp;sample_spec)</td></tr>
<tr class="memdesc:af1ec4c62334dacda1699aad9401f4c3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize.  <a href="classroc_1_1audio_1_1LatencyTuner.html#af1ec4c62334dacda1699aad9401f4c3c">More...</a><br /></td></tr>
<tr class="separator:af1ec4c62334dacda1699aad9401f4c3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63d6442cf008bd2c6ce95bff4431f7f2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#a63d6442cf008bd2c6ce95bff4431f7f2">is_valid</a> () const</td></tr>
<tr class="memdesc:a63d6442cf008bd2c6ce95bff4431f7f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the object was initialized successfully.  <a href="classroc_1_1audio_1_1LatencyTuner.html#a63d6442cf008bd2c6ce95bff4431f7f2">More...</a><br /></td></tr>
<tr class="separator:a63d6442cf008bd2c6ce95bff4431f7f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0385672e45b91198237257b7313515e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#ac0385672e45b91198237257b7313515e">write_metrics</a> (const <a class="el" href="structroc_1_1audio_1_1LatencyMetrics.html">LatencyMetrics</a> &amp;latency_metrics, const <a class="el" href="structroc_1_1packet_1_1LinkMetrics.html">packet::LinkMetrics</a> &amp;link_metrics)</td></tr>
<tr class="memdesc:ac0385672e45b91198237257b7313515e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pass updated metrics to tuner. Tuner will use new values next time when <a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#a9bd9a4c1fae2eec979881ed614ae8024" title="Update stream latency and scaling. This method performs all actual work:">update_stream()</a> is called.  <a href="classroc_1_1audio_1_1LatencyTuner.html#ac0385672e45b91198237257b7313515e">More...</a><br /></td></tr>
<tr class="separator:ac0385672e45b91198237257b7313515e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bd9a4c1fae2eec979881ed614ae8024"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#a9bd9a4c1fae2eec979881ed614ae8024">update_stream</a> ()</td></tr>
<tr class="memdesc:a9bd9a4c1fae2eec979881ed614ae8024"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update stream latency and scaling. This method performs all actual work:  <a href="classroc_1_1audio_1_1LatencyTuner.html#a9bd9a4c1fae2eec979881ed614ae8024">More...</a><br /></td></tr>
<tr class="separator:a9bd9a4c1fae2eec979881ed614ae8024"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41cd1e196e6e2faa47cd52f1c3612911"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#a41cd1e196e6e2faa47cd52f1c3612911">advance_stream</a> (<a class="el" href="namespaceroc_1_1packet.html#aa66753c075bbc4f90d82075a4944abbe">packet::stream_timestamp_t</a> duration)</td></tr>
<tr class="memdesc:a41cd1e196e6e2faa47cd52f1c3612911"><td class="mdescLeft">&#160;</td><td class="mdescRight">Advance stream by given number of samples. Should be called after updating stream.  <a href="classroc_1_1audio_1_1LatencyTuner.html#a41cd1e196e6e2faa47cd52f1c3612911">More...</a><br /></td></tr>
<tr class="separator:a41cd1e196e6e2faa47cd52f1c3612911"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4c5612973bd32180f1b513801f555d7"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#ac4c5612973bd32180f1b513801f555d7">get_scaling</a> () const</td></tr>
<tr class="memdesc:ac4c5612973bd32180f1b513801f555d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get computed scaling. Latency tuner expects that this scaling will applied to the stream resampler, so that the latency will slowly achieve target value. Returned value is close to 1.0. If no scaling was computed yet, it returns 0.0.  <a href="classroc_1_1audio_1_1LatencyTuner.html#ac4c5612973bd32180f1b513801f555d7">More...</a><br /></td></tr>
<tr class="separator:ac4c5612973bd32180f1b513801f555d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Latency tuner. </p>
<p>On receiver, <a class="el" href="classroc_1_1audio_1_1LatencyMonitor.html" title="Latency monitor.">LatencyMonitor</a> computes local metrics and passes them to <a class="el" href="classroc_1_1audio_1_1LatencyTuner.html" title="Latency tuner.">LatencyTuner</a>. On sender, <a class="el" href="classroc_1_1audio_1_1FeedbackMonitor.html" title="Feedback monitor.">FeedbackMonitor</a> obtains remote metrics and passes them to <a class="el" href="classroc_1_1audio_1_1LatencyTuner.html" title="Latency tuner.">LatencyTuner</a>. In both cases, <a class="el" href="classroc_1_1audio_1_1LatencyTuner.html" title="Latency tuner.">LatencyTuner</a> processes metrics and computes scaling factor that should be passed to resampler.</p>
<p>Features:</p><ul>
<li>monitors how close actual latency and target latency are</li>
<li>monitors whether latency goes out of bounds</li>
<li>assuming that the difference between actual latency and target latency is caused by the clock drift between sender and receiver, calculates scaling factor for resampler to compensate it </li>
</ul>

<p class="definition">Definition at line <a class="el" href="latency__tuner_8h_source.html#l00174">174</a> of file <a class="el" href="latency__tuner_8h_source.html">latency_tuner.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="af1ec4c62334dacda1699aad9401f4c3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1ec4c62334dacda1699aad9401f4c3c">&#9670;&nbsp;</a></span>LatencyTuner()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">roc::audio::LatencyTuner::LatencyTuner </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structroc_1_1audio_1_1LatencyConfig.html">LatencyConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classroc_1_1audio_1_1SampleSpec.html">SampleSpec</a> &amp;&#160;</td>
          <td class="paramname"><em>sample_spec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a41cd1e196e6e2faa47cd52f1c3612911"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41cd1e196e6e2faa47cd52f1c3612911">&#9670;&nbsp;</a></span>advance_stream()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void roc::audio::LatencyTuner::advance_stream </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceroc_1_1packet.html#aa66753c075bbc4f90d82075a4944abbe">packet::stream_timestamp_t</a>&#160;</td>
          <td class="paramname"><em>duration</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Advance stream by given number of samples. Should be called after updating stream. </p>

</div>
</div>
<a id="ac4c5612973bd32180f1b513801f555d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4c5612973bd32180f1b513801f555d7">&#9670;&nbsp;</a></span>get_scaling()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float roc::audio::LatencyTuner::get_scaling </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get computed scaling. Latency tuner expects that this scaling will applied to the stream resampler, so that the latency will slowly achieve target value. Returned value is close to 1.0. If no scaling was computed yet, it returns 0.0. </p>

</div>
</div>
<a id="a63d6442cf008bd2c6ce95bff4431f7f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63d6442cf008bd2c6ce95bff4431f7f2">&#9670;&nbsp;</a></span>is_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool roc::audio::LatencyTuner::is_valid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the object was initialized successfully. </p>

</div>
</div>
<a id="a9bd9a4c1fae2eec979881ed614ae8024"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bd9a4c1fae2eec979881ed614ae8024">&#9670;&nbsp;</a></span>update_stream()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool roc::audio::LatencyTuner::update_stream </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update stream latency and scaling. This method performs all actual work: </p>
<ul>
<li>depending on configured backend, selects which latency from metrics to use</li>
<li>check if latency goes out of bounds and session should be terminated; if so, returns false</li>
<li>computes updated scaling based on latency history and configured profile </li>
</ul>

</div>
</div>
<a id="ac0385672e45b91198237257b7313515e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0385672e45b91198237257b7313515e">&#9670;&nbsp;</a></span>write_metrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void roc::audio::LatencyTuner::write_metrics </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structroc_1_1audio_1_1LatencyMetrics.html">LatencyMetrics</a> &amp;&#160;</td>
          <td class="paramname"><em>latency_metrics</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structroc_1_1packet_1_1LinkMetrics.html">packet::LinkMetrics</a> &amp;&#160;</td>
          <td class="paramname"><em>link_metrics</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pass updated metrics to tuner. Tuner will use new values next time when <a class="el" href="classroc_1_1audio_1_1LatencyTuner.html#a9bd9a4c1fae2eec979881ed614ae8024" title="Update stream latency and scaling. This method performs all actual work:">update_stream()</a> is called. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>roc_audio/<a class="el" href="latency__tuner_8h_source.html">latency_tuner.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceroc.html">roc</a></li><li class="navelem"><a class="el" href="namespaceroc_1_1audio.html">audio</a></li><li class="navelem"><a class="el" href="classroc_1_1audio_1_1LatencyTuner.html">LatencyTuner</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
